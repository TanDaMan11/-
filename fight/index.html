<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Smash Clone</title>
<style>
body { margin:0; background:#111; overflow:hidden }
canvas { display:block }
</style>
</head>
<body>
<canvas id="c"></canvas>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
const c = document.getElementById("c");
const ctx = c.getContext("2d");
c.width = innerWidth;
c.height = innerHeight;

const socket = io("https://8o2lymxge7.onrender.com");

let players = {};
let me = null;

const gravity = 0.8;
const speed = 5;
const jump = -14;
const platforms = [{x:0,y:600,w:2000,h:40}];
const keys = {};

onkeydown = e => keys[e.key] = true;
onkeyup = e => keys[e.key] = false;
onmousedown = () => socket.emit("attack");

socket.on("connect", () => me = socket.id);
socket.on("state", s => players = s);
socket.on("playerMove", p => players[p.id] = p);

function update() {
  if (!players[me]) return;
  const p = players[me];

  if (keys.a) { p.vx = -speed; p.facing = -1; }
  else if (keys.d) { p.vx = speed; p.facing = 1; }
  else p.vx *= 0.8;

  if (keys.w && p.y > 550) p.vy = jump;

  if (keys["1"]) socket.emit("weapon","sword");
  if (keys["2"]) socket.emit("weapon","blaster");

  p.vy += gravity;
  p.x += p.vx;
  p.y += p.vy;

  if (p.y > 560) { p.y = 560; p.vy = 0; }

  socket.emit("move", {
    x:p.x, y:p.y, vx:p.vx, vy:p.vy, facing:p.facing
  });
}

function draw() {
  update();
  ctx.clearRect(0,0,c.width,c.height);

  ctx.fillStyle="#555";
  platforms.forEach(p=>ctx.fillRect(p.x,p.y,p.w,p.h));

  for (let id in players) {
    const p = players[id];
    ctx.fillStyle = id===me?"#0f0":"#f00";
    ctx.fillRect(p.x-20,p.y-20,40,40);
    ctx.fillText(Math.floor(p.damage)+"%",p.x-15,p.y-30);
  }

  requestAnimationFrame(draw);
}
draw();
</script>
</body>
</html>
